platform: linux

inputs:
  - name: source

outputs:
  - name: source
  - name: metadata

params:
  VERSION: ""

run:
  path: bash
  args:
    - -ec
    - |
      echo -n ${VERSION} > metadata/tag
      echo "Publishing version ${VERSION} of the chart" > source/latest-release

      cd source
      git config user.name 'Concourse CI'
      git config user.email 'ci@watchedsky.social'
      git add -A
      git commit -m 'Updated latest-release file' || true
